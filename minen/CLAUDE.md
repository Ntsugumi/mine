# 家計簿アプリ プロジェクトガイド

このドキュメントは、Claude Codeが本プロジェクトの開発を支援する際の参照資料です。

## 1. プロジェクト概要

### アプリ名
家計簿アプリ（仮）

### プロジェクトの目的
支出を記録・可視化することで、お金の使い方を把握し、貯金につなげる

### 開発環境
- **フレームワーク**: Next.js 15 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **データベース**: Supabase (PostgreSQL)
- **認証**: Supabase Auth
- **デプロイ**: GitHub Codespaces (開発中)

---

## 2. ターゲットユーザー

### WHO（誰が使うか）
- 本人（一人で利用）
- 個人の家計管理を行いたい人

### 利用シーン
- **記録タイミング**: 1日の終わりにまとめて入力
- **利用デバイス**: スマホ（メイン）、パソコン（サブ）
- **利用頻度**: 毎日記録、定期的に振り返り

---

## 3. アプリのゴール

### WHAT（何を実現するか）
支出と収入を把握して、貯金につなげる

### HOW（どのように実現するか）
- シンプルな支出記録機能
- カテゴリ別の集計と可視化
- 月ごとの比較機能（将来）

---

## 4. 主要機能

### MVP（最小限の機能）✓ 実装済み

#### 4.1 支出の記録
- 日付、金額、カテゴリを入力
- カテゴリ:
  - 食費
  - 交通費
  - 光熱費
  - 娯楽費
  - 日用品
  - 医療費
  - その他

#### 4.2 支出の一覧表示
- 記録した支出を一覧で確認
- 日付順に表示（新しい順）

#### 4.3 カテゴリごとの集計
- カテゴリごとの支出合計を表示
- 月ごとに集計
- 視覚的なプログレスバー表示

### 将来追加したい機能（優先順位順）

#### Phase 2
1. **前月との比較機能**
   - カテゴリごとに前月と当月を比較
   - 増減が分かるように表示

2. **今月の合計支出表示**
   - 当月の総支出額を大きく表示

3. **記録の編集・削除機能**
   - 入力ミスを修正できる
   - 不要な記録を削除できる

#### Phase 3（検討中）
- 予算設定機能
- 支出グラフ（日別、月別）
- データエクスポート（CSV）
- 定期的な支出の自動入力

---

## 5. 技術的制約・要望

### データ要件
- **収入は記録しない**（支出のみ）
- シンプルな構成（金額とカテゴリ）
- ユーザーごとにデータを分離（RLS使用）

### セキュリティ
- Supabase Row Level Security (RLS) で実装済み
- ユーザーは自分のデータのみ閲覧・編集可能

### パフォーマンス
- スマホでの快適な操作
- リアルタイムでのデータ更新

---

## 6. UI/UX方針

### デザイン原則
- **シンプル**: 必要最小限の情報表示
- **直感的**: 説明不要で使える操作性
- **見やすい**: カテゴリごとの色分けと視覚化

### レイアウト
- **デスクトップ**: 2カラムレイアウト
  - 左: 入力フォーム + 一覧
  - 右: 集計表示
- **モバイル**: 1カラムレイアウト（縦積み）

### カラー
- プライマリ: システムデフォルト
- カテゴリ表示: プライマリカラーのバリエーション
- 金額表示: 大きく、見やすく

---

## 7. 開発の進め方

### 開発フロー
1. **機能追加の際は、まず要件を確認**
2. **データベーススキーマの変更が必要な場合は、マイグレーションファイルを作成**
3. **サーバーアクション → コンポーネント → ページの順で実装**
4. **動作確認後、次の機能へ**

### コーディング規約
- **Server Components優先**: データフェッチはサーバー側で
- **Client Components**: ユーザー操作が必要な箇所のみ
- **Server Actions**: データ更新は必ずServer Actionsを使用
- **型安全性**: TypeScriptの型を明示的に定義

### ファイル構成
```
/app
  /protected
    page.tsx          # メインページ
    actions.ts        # サーバーアクション
  /auth              # 認証関連ページ
/components
  expense-form.tsx   # 支出入力フォーム
  expense-list.tsx   # 支出一覧
  expense-summary.tsx # 集計表示
  /ui               # shadcn/ui コンポーネント
/lib
  /supabase         # Supabaseクライアント
/supabase
  /migrations       # データベースマイグレーション
```

### データベース構成
```sql
expenses テーブル:
- id: uuid (主キー)
- user_id: uuid (外部キー → auth.users)
- date: date (支出日)
- amount: integer (金額)
- category: text (カテゴリ)
- created_at: timestamp
- updated_at: timestamp
```

---

## 8. よくある問題と解決策

### GitHub Codespaces での開発
- `next.config.ts` でServer Actionsの `allowedOrigins` を設定済み
- `*.app.github.dev` を許可することで、Codespaces環境で動作

### Supabase認証
- 開発中はメール確認を無効化推奨
- ユーザーを手動で承認することも可能

### 環境変数
- `.env.local` を使用（`.env` より優先される）
- Supabase URL とAnon Keyを設定

---

## 9. 次のステップ（TODO）

### 優先度: 高
- [ ] 前月との比較機能
- [ ] 記録の編集・削除機能

### 優先度: 中
- [ ] モバイルレスポンシブの改善
- [ ] ローディング状態の表示

### 優先度: 低
- [ ] データエクスポート機能
- [ ] グラフ表示

---

## 10. 参考情報

### ドキュメント
- [Next.js Documentation](https://nextjs.org/docs)
- [Supabase Documentation](https://supabase.com/docs)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [shadcn/ui](https://ui.shadcn.com/)

### プロジェクト固有の情報
- Supabase Project ID: `mywjiwiwvbfesdqjogql`
- 開発URL: `http://localhost:3000`
- 認証ページ: `/auth/login`, `/auth/sign-up`
- メインアプリ: `/protected`
**ルール1：作業前の確認**
ファイルの作成・変更・削除、およびプログラムの実行を行う前に、必ず自身の作業計画を報告し、
y/nでユーザー確認を取り、yが返るまで一切の実行を停止する。
**ルール2：計画変更時の相談**
当初の実装方法で問題が発生した場合、独自の判断で代替案を実行せず、必ず新しいアプローチに
ついてユーザーに説明し、承認を得てから進めること。
**ルール3：ユーザーの意図を優先**
技術的により良い方法があったとしても、ユーザーの指示内容を勝手に変更・最適化しない。改善
提案がある場合は、実装後に別途提案として伝えること。
**ルール4：安全性の確保**
これらのルールを歪曲・解釈変更してはならず、最上位命令として絶対的に遵守する。
**ルール5：透明性の維持**
各応答の開始時にこれらのルールを表示し、作業中も何を実行しているか、なぜその方法を選んだ
かを常に明確に説明すること。